version: "3.9"

services:
  postgres:
    image: postgres:16-alpine
    environment:
      POSTGRES_USER: taktflow
      POSTGRES_PASSWORD: taktflow_dev
      POSTGRES_DB: taktflow
    ports: ["5432:5432"]
    volumes:
      - pgdata:/var/lib/postgresql/data
      - ./scripts/init-db.sql:/docker-entrypoint-initdb.d/init.sql

  redis:
    image: redis:7-alpine
    ports: ["6379:6379"]

  api-gateway:
    build: ./services/api-gateway
    ports: ["3000:3000"]
    env_file: .env
    depends_on: [auth-service, project-service, takt-engine, flowline-service]

  auth-service:
    build: ./services/auth-service
    ports: ["3001:3001"]
    env_file: .env
    depends_on: [postgres, redis]

  project-service:
    build: ./services/project-service
    ports: ["3002:3002"]
    env_file: .env
    depends_on: [postgres]

  takt-engine:
    build: ./services/takt-engine
    ports: ["8001:8001"]
    env_file: .env

  flowline-service:
    build: ./services/flowline-service
    ports: ["3003:3003"]
    env_file: .env

volumes:
  pgdata:
